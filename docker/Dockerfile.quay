FROM quay.io/redsift/ingraind-build:latest AS build

ADD . /build/
RUN cp /tmp/bcc/build/src/cc/libbpf.a /build/bpf-sys/lib/ \
    && cargo build --target=x86_64-unknown-linux-musl --release

FROM scratch

COPY --from=build /build/target/x86_64-unknown-linux-musl/release/ingraind /ingraind
CMD ["/ingraind"]
